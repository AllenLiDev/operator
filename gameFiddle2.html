<!DOCTYPE html>
<html lang = "en">
<head>
	<meta charset = "utf-8">
	<title>Operator!</title>
	<style>
	body, html {
		margin: 0;
		overflow: hidden;
	}
	canvas {
		background-color: #F68C02;
	}
	@font-face {
		font-family: "Digital7";
		src: url("./assets/digital-7.ttf");
	}
	</style>
	<script src="https://cdn.jsdelivr.net/jquery/3.0.0-beta1/jquery.min.js"></script>
</head>

<body>
	<canvas id="canvas"></canvas>
	<script>
	window.requestAnimFrame = (function() {
	return  window.requestAnimationFrame       || 
			window.webkitRequestAnimationFrame || 
			window.mozRequestAnimationFrame    || 
			window.oRequestAnimationFrame      || 
			window.msRequestAnimationFrame     || 
			function(/* function */ callback, /* DOMElement */ element){
				window.setTimeout(callback, 1000 / 60);
			};
	})();

	var gameArea = {
		canvas : document.getElementById("canvas"),
		ctx : canvas.getContext("2d"),
		WIDTH : 960,
		HEIGHT : 540,
		ratioX : null,
		ratioY : null,
		entities : [],
		lastTime : null,
		gameTime : 0,
		state : 0,
		refTime : 0,
		xMouse : null,
		yMouse : null,
		difficulty : 0,
		score : 0,
		sound : true,
		init : function() {
			this.canvas.width = window.innerWidth;
			this.canvas.height = window.innerHeight;
			this.ratioX = this.canvas.width / gameArea.WIDTH;
			this.ratioY = this.canvas.height / gameArea.HEIGHT;

			window.addEventListener("resize", gameArea.resize);
			gameArea.canvas.addEventListener("click", clickCollision);
			gameArea.canvas.addEventListener("mousedown", dragCollision);
			gameArea.canvas.addEventListener("mousemove", getCoords);
			gameArea.canvas.addEventListener("mouseup", dropCollision);

			gameArea.entities = load.menuScreen();

			this.lastTime = Date.now();
			main();
		},
		resize : function() {
			this.canvas.width = window.innerWidth;
			this.canvas.height = window.innerHeight;
			gameArea.ratioX = this.canvas.width / gameArea.WIDTH;
			gameArea.ratioY = this.canvas.height / gameArea.HEIGHT;
		},
		render : function() {
			this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
			if (this.entities.length > 0) {
				for (var i = 0; i < this.entities.length; i++) {
					var img = new Image();
					img.src = this.entities[i].src;
					img.width = this.entities[i].width;
					img.height = this.entities[i].height;
					img.xPos = this.entities[i].xPos;
					img.yPos = this.entities[i].yPos;
					img.index = this.entities[i].index;
					this.ctx.drawImage(img, 0, img.index * img.height, img.width, img.height, img.xPos * this.ratioX, img.yPos * this.ratioY, img.width * this.ratioX, img.height * this.ratioY);
				}
			} else {
				alert("Programmer error. Empty entities list.");
			}
			if (load.strings.length > 0) {
				this.ctx.scale(this.ratioX, this.ratioY);
				for (var i = 0; i < load.strings.length; i++) {
					this.ctx.font = load.strings[i].sizeInit + load.strings[i].font;
					this.ctx.fillText(load.strings[i].parameter, load.strings[i].xPos, load.strings[i].yPos, load.strings[i].maxWidth);
				}
				this.ctx.scale(1 / this.ratioX, 1 / this.ratioY);
			}
		}
	}

	function getCoords(event) {
		gameArea.xMouse = event.clientX;
		gameArea.yMouse = event.clientY;
	}

	function main() {
		var now = Date.now();
		var dt = (now - gameArea.lastTime) / 1000.0;

		update(dt);
		gameArea.render();

		gameArea.lastTime = now;
		window.requestAnimFrame(main);
	}

	var step1 = false;
	var step2 = false;
	var step3 = false;
	function easterEgg(button){
		if (button == 4) {
			step3 = false;
			step2 = false;
			step1 = true;
		} else if (button == 3) {
			if(step1 && !step2){
				step2 = true;
			}
			else{
				step1 = false;
				step2 = false;
				step3 = false;
			}
		} else if (button == 1) {
			if(step1 && step2 && !step3){
				step3 = true;
			}
			else{
				step1 = false;
				step2 = false;
				step3 = false;
			}
		} else if (button == 2) {
			if (step1 && step2 && step3) {
				window.alert("Now you know BEDMAS!");
			}
			else{				
				step1 = false;
				step2 = false;
				step3 = false;
			}
		}
	}

	var load = {
		entities : [],
		clickable : [],
		droppable : [],
		strings : [],
		problem : [],
		clear : function() {
			load.entities = [];
			load.clickable = [];
			load.droppable = [];
			load.strings = [];
			load.problem = [];
		},
		menuScreen : function() {
			load.clear();

			var background = new Image();
			background = {
				src : "./assets/menuAssets/background.png",
				width : 960,
				height : 540,
				xPos : 0,
				yPos : 0,
				index: 0
			}

			var staticImage = new Image();
			staticImage = {
				src : "./assets/menuAssets/staticBackground.png",
				width : 960,
				height : 540,
				xPos : 0,
				yPos : 0,
				index: 0
			}

			var timeAtkImage = new Image();
			timeAtkImage = {
				src : "./assets/menuAssets/timeAttackButton.png",
				width : 480,
				height : 130,
				xPos : 0,
				yPos : 270,
				index: 0
			}

			var timeAtkBox = {
				xMin : 20,
				yMin : 270,
				xMax : 475,
				yMax : 390,
				clicked : function() {
					gameArea.entities = [];
					gameArea.entities = load.preGameScreen();
					gameArea.state = 1;
				}
			}
			
			var endlessImage = new Image();
			endlessImage = {
				src : "./assets/menuAssets/endlessButton.png",
				width : 480,
				height : 130,
				xPos : 480,
				yPos : 270,
				index: 0
			}

			var endlessBox = {
				xMin : 485,
				yMin : 270,
				xMax : 940,
				yMax : 390,
				clicked : function() {
					gameArea.entities = [];
					gameArea.entities = load.preGameScreen();
					gameArea.state = 2;
				}
			}
			
			var audioImage = new Image();
			audioImage = {
				src : "./assets/menuAssets/audioButton.png",
				width : 126,
				height : 126,
				xPos : 834,
				yPos : 0,
				index: (function() {
					if (gameArea.sound) {
						return 0;
					} else {
						return 1;
					}
				})(),
				frames: 2
			}

			var audioBox = {
				xMin : 846,
				yMin : 25,
				xMax : 926,
				yMax : 105,
				clicked : function() {
					if (gameArea.sound) {
						gameArea.entities[4].index = 1;
						gameArea.sound = false;
					} else {
						gameArea.entities[4].index = 0;
						gameArea.sound = true;
					}
				}
			}

			var leaderImage = new Image();
			leaderImage = {
				src : "./assets/menuAssets/leaderButton.png",
				width : 329,
				height : 140,
				xPos : 631,
				yPos : 400,
				index: 0
			}

			var leaderBox = {
				xMin : 640,
				yMin : 400,
				xMax : 940,
				yMax : 520,
				clicked : function() {
					load.leaderScreen();
				}
			}

			var guideImage = new Image();
			guideImage = {
				src : "./assets/menuAssets/guideButton.png",
				width : 300,
				height : 140,
				xPos : 331,
				yPos : 400,
				index: 0
			}

			var guideBox = {
				xMin : 331,
				yMin : 400,
				xMax : 631,
				yMax : 520,
				clicked : function() {
					load.guideScreen();
				}
			}

			var settingImage = new Image();
			settingImage = {
				src : "./assets/menuAssets/settingButton.png",
				width : 331,
				height : 140,
				xPos : 0,
				yPos : 400,
				index: 0
			}

			var settingBox = {
				xMin : 20,
				yMin : 400,
				xMax : 320,
				yMax : 520,
				clicked : function() {
					gameArea.entities = [];
					gameArea.entities = load.settingScreen();
				}
			}

			var symbolAdd = {
				xMin : 348,
				yMin : 174,
				xMax : 413,
				yMax : 243,
				clicked : function(){
					easterEgg(1);
				}
			}

			var symbolMinus = {
				xMin : 414,
				yMin : 174,
				xMax : 479,
				yMax : 243,
				clicked : function(){
					easterEgg(2);
				}
			}

			var symbolMulti = {
				xMin : 480,
				yMin : 174,
				xMax : 545,
				yMax : 243,
				clicked : function(){
					easterEgg(3);
				}
			}

			var symbolDivide = {
				xMin : 546,
				yMin : 174,
				xMax : 611,
				yMax : 243,
				clicked : function(){
					easterEgg(4);
				}
			}

			load.entities.push(background, staticImage, timeAtkImage, endlessImage, audioImage, leaderImage, guideImage, settingImage);

			load.clickable.push(timeAtkBox, endlessBox, audioBox, leaderBox, guideBox, settingBox, symbolAdd, symbolMinus, symbolMulti, symbolDivide);

			return load.entities;
		},
		preGameScreen : function() {
			load.clear();

			var background = new Image();
			background = {
				src : "./assets/preGameAssets/pregame.png",
				width : 960,
				height : 540,
				xPos : 0,
				yPos : 0,
				index: 0
			}

			var countSprite = new Image();
			countSprite = {
				src : "./assets/preGameAssets/countdown.png",
				width : 170,
				height : 231,
				xPos : 395,
				yPos : 210,
				index : 0,
				frames : 3
			}

			load.entities.push(background, countSprite);

			return load.entities;
		},
		gameScreen : function() {
			load.clear();

			var background = new Image();
			background = {
				src : "./assets/gameAssets/background.png",
				width : 960,
				height : 540,
				xPos : 0,
				yPos : 0,
				index: 0
			}

			var gameBorderImage = new Image();
			gameBorderImage = {
				src : "./assets/gameAssets/gameBorderImage.png",
				width : 960,
				height : 540,
				xPos : 0,
				yPos : 0,
				index: 0
			}

			var cardsImage = new Image();
			cardsImage = {
				src : "./assets/gameAssets/cardsImage.png",
				width : 960,
				height : 219,
				xPos : 0,
				yPos : 208,
				index: 0,
				frames : 3
			}

			var quitImage = new Image();
			quitImage = {
				src : "./assets/gameAssets/quitImage.png",
				width : 220,
				height : 208,
				xPos : 0,
				yPos : 0,
				index: 0
			}

			var quitBox = {
				xMin : 20,
				yMin : 20,
				xMax : 220,
				yMax : 110,
				clicked : function() {
					gameArea.entities = [];
					gameArea.state = 0;
					gameArea.refTime = 0;
					gameArea.score = 0;
					gameArea.entities = load.menuScreen();
				}
			}

			var skipImage = new Image();
			skipImage = {
				src : "./assets/gameAssets/skipImage.png",
				width : 220,
				height : 208,
				xPos : 740,
				yPos : 0,
				index: 0
			}

			var plusOperator = new Image();
			plusOperator = {
				src : "./assets/gameAssets/plusOperator.png",
				width : 80,
				height : 80,
				xPos : 260,
				yPos : 449,
				xInit : 260,
				yInit : 449,
				index : 0,
				xMin : 260,
				yMin : 449,
				xMax : 340,
				yMax : 529,
				caseOp : 1,
				isDraggable : true,
				isClicked : false,
				parameter : " + "
			}

			var plusOp2 = new Image();
			plusOp2 = {
				src : "./assets/gameAssets/plusOperator.png",
				width : 80,
				height : 80,
				index : 0
			}

			var plusOp3 = new Image();
			plusOp3 = {
				src : "./assets/gameAssets/plusOperator.png",
				width : 80,
				height : 80,
				index : 0
			}

			var plusOp4 = new Image();
			plusOp4 = {
				src : "./assets/gameAssets/plusOperator.png",
				width : 80,
				height : 80,
				index : 0
			}
			
			var minusOperator = new Image();
			minusOperator = {
				src : "./assets/gameAssets/minusOperator.png",
				width : 80,
				height : 80,
				xPos : 380,
				yPos : 449,
				xInit : 380,
				yInit : 449,
				index : 0,
				xMin : 380,
				yMin : 449,
				xMax : 460,
				yMax : 529,
				caseOp : 1,
				isDraggable : true,
				isClicked : false,
				parameter : "-"
			}

			var minusOp2 = new Image();
			minusOp2 = {
				src : "./assets/gameAssets/minusOperator.png",
				width : 80,
				height : 80,
				index : 0
			}

			var minusOp3 = new Image();
			minusOp3 = {
				src : "./assets/gameAssets/minusOperator.png",
				width : 80,
				height : 80,
				index : 0
			}

			var minusOp4 = new Image();
			minusOp4 = {
				src : "./assets/gameAssets/minusOperator.png",
				width : 80,
				height : 80,
				index : 0
			}

			var multiOperator = new Image();
			multiOperator = {
				src : "./assets/gameAssets/multiOperator.png",
				width : 80,
				height : 80,
				xPos : 500,
				yPos : 449,
				xInit : 500,
				yInit : 449,
				index : 0,
				xMin : 500,
				yMin : 449,
				xMax : 580,
				yMax : 529,
				caseOp : 1,
				isDraggable : true,
				isClicked : false,
				parameter : "*"
			}

			var multiOp2 = new Image();
			multiOp2 = {
				src : "./assets/gameAssets/multiOperator.png",
				width : 80,
				height : 80,
				index : 0
			}

			var multiOp3 = new Image();
			multiOp3 = {
				src : "./assets/gameAssets/multiOperator.png",
				width : 80,
				height : 80,
				index : 0
			}

			var multiOp4 = new Image();
			multiOp4 = {
				src : "./assets/gameAssets/multiOperator.png",
				width : 80,
				height : 80,
				index : 0
			}

			var divOperator = new Image();
			divOperator = {
				src : "./assets/gameAssets/divOperator.png",
				width : 80,
				height : 80,
				xPos : 620,
				yPos : 449,
				xInit : 620,
				yInit : 449,
				index : 0,
				xMin : 620,
				yMin : 449,
				xMax : 700,
				yMax : 529,
				caseOp : 1,
				isDraggable : true,
				isClicked : false,
				parameter : "/"
			}

			var divOp2 = new Image();
			divOp2 = {
				src : "./assets/gameAssets/divOperator.png",
				width : 80,
				height : 80,
				index : 0
			}

			var divOp3 = new Image();
			divOp3 = {
				src : "./assets/gameAssets/divOperator.png",
				width : 80,
				height : 80,
				index : 0
			}

			var divOp4 = new Image();
			divOp4 = {
				src : "./assets/gameAssets/divOperator.png",
				width : 80,
				height : 80,
				index : 0
			}

			var firstDrop = {
				xMin : 200,
				yMin : 278,
				xMax : 280,
				yMax : 358,
				isFilled : false,
				parameter : ""
			}

			var secondDrop = {
				xMin : 440,
				yMin : 278,
				xMax : 520,
				yMax : 358,
				isFilled : false,
				parameter : ""
			}

			var thirdDrop = {
				xMin : 680,
				yMin : 278,
				xMax : 760,
				yMax : 358,
				isFilled : false,
				parameter : ""
			}

			var timerString = {
				font : "em Digital7",
				sizeInit : 8,
				xPos : 368,
				yPos : 175,
				parameter : gameArea.refTime,
				maxWidth : 304
			}

			var card1 = {
				font : "em Calibri",
				sizeInit : 16,
				xPos : 49,
				yPos : 394,
				parameter : 0,
				maxWidth : 141
			}

			var card2 = {
				font : "em Calibri",
				sizeInit : 16,
				xPos : 289,
				yPos : 394,
				parameter : 0,
				maxWidth : 141
			}

			var card3 = {
				font : "em Calibri",
				sizeInit : 16,
				xPos : 530,
				yPos : 394,
				parameter : 0,
				maxWidth : 141
			}

			var card4 = {
				font : "em Calibri",
				sizeInit : 16,
				xPos : 770,
				yPos : 394,
				parameter : 0,
				maxWidth : 141
			}

			load.entities.push(background, gameBorderImage, scoreImage, cardsImage, quitImage, skipImage, plusOperator, plusOp2, plusOp3, plusOp4, minusOperator, minusOp2, minusOp3, minusOp4, multiOperator, multiOp2, multiOp3, multiOp4, divOperator, divOp2, divOp3, divOp4);
			load.clickable.push(quitBox);
			load.droppable.push(firstDrop, secondDrop, thirdDrop);
			load.strings.push(timerString, card1, card2, card3, card4);

			switch (gameArea.state) {
				case 1:
					var score = new Image();
					score = {
						src : "./assets/gameAssets/progress.png",
						width : 198,
						height : 32,
						xPos : 491,
						yPos : 30,
						index: 0,
						frames: 11
					}

					var scoreImage = new Image();
					scoreImage = {
						src : "./assets/gameAssets/scoreboard.png",
						width : 439,
						height : 178,
						xPos : 260,
						yPos : 20,
						index: 0
					}

					load.entities[2] = scoreImage;
					load.entities.push(score);
					break;
				default:
			}

			return load.entities;

		},
		settingScreen : function() {
			load.clear();

			var background = new Image();
			background = {
				src : "./assets/menuAssets/background.png",
				width : 960,
				height : 540,
				xPos : 0,
				yPos : 0,
				index: 0
			}

			var border = new Image();
			border = {
				src : "./assets/settingsAssets/border.png",
				width : 960,
				height : 540,
				xPos : 0,
				yPos : 0,
				index: 0
			}

			var quitImage = new Image();
			quitImage = {
				src : "./assets/gameAssets/quitImage.png",
				width : 220,
				height : 208,
				xPos : 0,
				yPos : 0,
				index: 0

			}

			var quitBox = {
				xMin : 20,
				yMin : 20,
				xMax : 220,
				yMax : 110,
				clicked : function() {
					gameArea.entities = [];
					gameArea.entities = load.menuScreen();
				}
			}

			var settingsTitle = new Image();
			settingsTitle = {
				src : "./assets/settingsAssets/settingsLabel.png",
				width : 392,
				height : 110,
				xPos : 284,
				yPos : 48,
				index : 0
			}

			var difficultyWindow = new Image();
			difficultyWindow = {
				src : "./assets/settingsAssets/difficultyWindow.png",
				width : 365,
				height : 180,
				xPos : 84,
				yPos : 225,
				index : 0
			}

			var difficultyOptions = new Image();
			difficultyOptions = {
				src : "./assets/settingsAssets/difficultyOptions.png",
				width : 280,
				height : 68,
				xPos : 130,
				yPos : 325,
				index: (function() {
					if (gameArea.difficulty == 1) {
						return 1
					} else {
						return 0;
					}
				})(),
				frames: 2
			}

			var easyBox = {
				xMin : 116,
				yMin : 326,
				xMax : 246,
				yMax : 390,
				clicked : function() {
					if (gameArea.difficulty == 1) {
						gameArea.entities[5].index -= 1;
						gameArea.difficulty = 0;
					}
				}
			}

			var hardBox = {
				xMin : 284,
				yMin : 326,
				xMax : 410,
				yMax : 390,
				clicked : function() {
					if (gameArea.difficulty == 0) {
						gameArea.entities[5].index +=1;
						gameArea.difficulty = 1;
					}
				}
			}


			var audioWindow = new Image();
			audioWindow = {
				src : "./assets/settingsAssets/audioWindow.png",
				width : 365,
				height : 180,
				xPos : 515,
				yPos : 225,
				index : 0
			}

			var audioOptions = new Image();
			audioOptions = {
				src : "./assets/settingsAssets/audioOptions.png",
				width : 280,
				height : 68,
				xPos : 563,
				yPos : 325,
				index: (function() {
					if (gameArea.sound) {
						return 0;
					} else {
						return 1;
					}
				})(),
				frames: 2
			}

			var onBox = {
				xMin : 576,
				yMin : 326,
				xMax : 676,
				yMax : 390,
				isClicked : true,
				clicked : function() {
					if (!gameArea.sound) {
						gameArea.sound = true;
						gameArea.entities[7].index = 0;
						//code needs to be here one day
					}
				}
			}

			var offBox = {
				xMin : 713,
				yMin : 326,
				xMax : 813,
				yMax : 390,
				isClicked : false,
				clicked : function() {
					if (gameArea.sound) {
						gameArea.sound = false;
						gameArea.entities[7].index = 1;
					}
				}
			}


			load.entities.push(background, border, quitImage, settingsTitle, difficultyWindow, difficultyOptions, audioWindow, audioOptions);
			load.clickable.push(quitBox, easyBox, hardBox, onBox, offBox);

			return load.entities;

		},
		leaderScreen : function() {
			load.clear();

			return load.entities;

		},
		guideScreen : function() {
			load.clear();

			return load.entities;
		},
		scoreScreen : function() {
			load.clear();

			var background = new Image();
			background = {
				src : "./assets/scoreAssets/timeAttackScore.png",
				width : 960,
				height : 540,
				xPos : 0,
				yPos : 0,
				index: 0
			}

			var replayImage = new Image();
			replayImage = {
				src : "./assets/scoreAssets/replay.png",
				width : 220,
				height : 208,
				xPos : 740,
				yPos : 0,
				index: 0
			}

			var submitImage = new Image();
			submitImage = {
				src : "./assets/scoreAssets/submit.png",
				width : 300,
				height : 67,
				xPos : 330,
				yPos : 413,
				index: 0
			}

			var quitImage = new Image();
			quitImage = {
				src : "./assets/gameAssets/quitImage.png",
				width : 220,
				height : 208,
				xPos : 0,
				yPos : 0,
				index: 0
			}

			var quitBox = {
				xMin : 20,
				yMin : 20,
				xMax : 220,
				yMax : 110,
				clicked : function() {
					gameArea.entities = [];
					gameArea.state = 0;
					gameArea.refTime = 0;
					gameArea.score = 0;
					gameArea.entities = load.menuScreen();
				}
			}

			var finalTime = {
				font : "em Calibri",
				sizeInit : 16,
				xPos : 527,
				yPos : 169,
				parameter : "",
				maxWidth : 141
			}

			var completed = {
				font : "em Calibri",
				sizeInit : 16,
				xPos : 527,
				yPos : 227,
				parameter : "",
				maxWidth : 141
			}

			load.entities.push(background, replayImage, submitImage, quitImage);
			load.clickable.push(quitBox);
			//load.strings.push(finalTime, completed);

			return load.entities;
		}
	}

	function update(dt) {
		gameArea.gameTime += dt;

		switch(gameArea.state) {
			case 1: //time attack logic
				gameArea.refTime += dt;

				if (gameArea.refTime > 1 && gameArea.entities.length == 2 && gameArea.entities[1].index < gameArea.entities[1].frames - 1) {
					gameArea.refTime -= 1;
					gameArea.entities[1].index += 1;
				} else if (gameArea.refTime > 1 && gameArea.entities.length == 2 && gameArea.entities[1].index == gameArea.entities[1].frames - 1) {
					gameArea.entities = [];
					gameArea.refTime = 0;
					gameArea.entities = load.gameScreen();
					load.problem = getProblem(timeAttackDifficulty(gameArea.score + 1, gameArea.difficulty), gameArea.difficulty);
					for (var i = 0; i < load.problem.length; i++) {
						load.strings[i + 1].parameter = load.problem[i];
					}
				} else if (load.strings.length > 0) {//loaded game logic
					load.strings[0].parameter = ((Math.floor(gameArea.refTime * 10) / 10));
					if (load.droppable[0].isFilled && load.droppable[1].isFilled && load.droppable[2].isFilled) {

						if (validate(load.strings[1].parameter, load.strings[2].parameter, load.strings[3].parameter, load.strings[4].parameter, load.droppable[0].parameter, load.droppable[1].parameter, load.droppable[2].parameter)) {

							if (gameArea.score + 1 == 10) {
								gameArea.entities = [];
								gameArea.entities = load.scoreScreen();
							} else {
								gameArea.score += 1;
								gameArea.entities[22].index = gameArea.score;
								load.problem = [];
								load.problem = getProblem(timeAttackDifficulty(gameArea.score + 1, gameArea.difficulty), gameArea.difficulty);
								for (var i = 0; i < load.problem.length; i++) {
									load.strings[i + 1].parameter = load.problem[i];
								}
								for (var i = 0; i < load.droppable.length; i++) {
									load.droppable[i].parameter = "";
									load.droppable[i].isFilled = false;
								}

								gameArea.entities[6].caseOp = 1;
								gameArea.entities[7].xPos = -100;
								gameArea.entities[8].xPos = -100;
								gameArea.entities[9].xPos = -100;
								gameArea.entities[10].caseOp = 1;
								gameArea.entities[11].xPos = -100;
								gameArea.entities[12].xPos = -100;
								gameArea.entities[13].xPos = -100;
								gameArea.entities[14].caseOp = 1;
								gameArea.entities[15].xPos = -100;
								gameArea.entities[16].xPos = -100;
								gameArea.entities[17].xPos = -100;
								gameArea.entities[18].caseOp = 1;
								gameArea.entities[19].xPos = -100;
								gameArea.entities[20].xPos = -100;
								gameArea.entities[21].xPos = -100;
							}
						} else {
							for (var i = 0; i < load.droppable.length; i++) {
								load.droppable[i].parameter = "";
								load.droppable[i].isFilled = false;
							}

							gameArea.entities[6].caseOp = 1;
							gameArea.entities[7].xPos = -100;
							gameArea.entities[8].xPos = -100;
							gameArea.entities[9].xPos = -100;
							gameArea.entities[10].caseOp = 1;
							gameArea.entities[11].xPos = -100;
							gameArea.entities[12].xPos = -100;
							gameArea.entities[13].xPos = -100;
							gameArea.entities[14].caseOp = 1;
							gameArea.entities[15].xPos = -100;
							gameArea.entities[16].xPos = -100;
							gameArea.entities[17].xPos = -100;
							gameArea.entities[18].caseOp = 1;
							gameArea.entities[19].xPos = -100;
							gameArea.entities[20].xPos = -100;
							gameArea.entities[21].xPos = -100;
						}
					}
				}
				break;
			case 2: //endless logic
				gameArea.refTime += dt;

				
				if (gameArea.refTime > 1 && gameArea.entities.length == 2 && gameArea.entities[1].index < gameArea.entities[1].frames - 1) {
					gameArea.refTime -= 1;
					gameArea.entities[1].index += 1;
				} else if (gameArea.refTime > 1 && gameArea.entities.length == 2 && gameArea.entities[1].index == gameArea.entities[1].frames - 1) {
					gameArea.entities = [];
					gameArea.refTime = 0;
					gameArea.entities = load.gameScreen();
				} else if (load.strings.length > 0) {//loaded game logic
					load.strings[0].parameter = ((Math.floor(gameArea.refTime * 10) / 10));
				}
				break;
			default: //main screen null logic

		}

		handleInput(dt);
	}

	function clickCollision() {
		var xCoord = gameArea.xMouse;
		var yCoord = gameArea.yMouse;

		for (var i = 0; i < load.clickable.length; i++) {
			if (load.clickable[i].xMin * gameArea.ratioX <= xCoord && load.clickable[i].xMax * gameArea.ratioX >= xCoord && load.clickable[i].yMin * gameArea.ratioY <= yCoord && load.clickable[i].yMax * gameArea.ratioY >= yCoord) {
				load.clickable[i].clicked();
			}
		}
	}

	function dragCollision() {
		var xCoord = gameArea.xMouse;
		var yCoord = gameArea.yMouse;

		for (var i = 0; i < gameArea.entities.length; i++) {
			if (gameArea.entities[i].xMin * gameArea.ratioX <= xCoord && gameArea.entities[i].xMax * gameArea.ratioX >= xCoord && gameArea.entities[i].yMin * gameArea.ratioY <= yCoord && gameArea.entities[i].yMax * gameArea.ratioY >= yCoord && gameArea.entities[i].isDraggable) {
				gameArea.entities[i].isClicked = true;
			}
		}
	}

	function getProblem(difficulty, hard) {
        var card1 = null;
        var card2 = null;
        var card3 = null;
        var card4 = null;
        var hue;
        $.ajax({
            async: false,
            type: "GET",
            url: "getProblem.php",
            dataType: "json",
            data: {difficulty: difficulty, hard: hard},
            success: function(data) {
                card1 = data.card1;
                card2 = data.card2;
                card3 = data.card3;
                card4 = data.card4;
            }
        });
        return [card1, card2, card3, card4];
    }

    function validate(c1, c2, c3, c4, op1, op2, op3) {
	    var string = c1 + op1 + c2 + op2 + c3 + op3 + c4;
	    if (eval(string) == 24) {
	        return true;
	    }
	    return false;
	}

	function timeAttackDifficulty(problemNum, hard) {
	    var difficulty = 1;
	    var twoPoint = 2;
	    var threePoint = 5;
	    var fourPoint = 8;
	    var fivePoint = 10;
	    if (hard) {
	        twoPoint = 1;
	        threePoint = 3;
	        fourPoint = 5;
	        fivePoint = 8;
	    }
	    if (problemNum >= fivePoint) {
	        difficulty = 5;
	    } else if (problemNum >= fourPoint) {
	        difficulty = 4;
	    } else if (problemNum >= threePoint) {
	        difficulty = 3;
	    } else if (problemNum >= twoPoint) {
	        difficulty = 2;
	    }
	    return difficulty;
	}

	function dropCollision() {
		for (var i = 0; i < gameArea.entities.length; i++) {
			if (gameArea.entities[i].isClicked) {
				for (var d = 0; d < load.droppable.length; d++) {
					if ((((gameArea.entities[i].xPos * gameArea.ratioX) >= (load.droppable[d].xMin * gameArea.ratioX)
						&& (gameArea.entities[i].xPos * gameArea.ratioX) <= (load.droppable[d].xMax * gameArea.ratioX)
						&& ((gameArea.entities[i].yPos + gameArea.entities[i].height) * gameArea.ratioY) >= (load.droppable[d].yMin * gameArea.ratioY)
						&& ((gameArea.entities[i].yPos + gameArea.entities[i].height) * gameArea.ratioY) <= (load.droppable[d].yMax * gameArea.ratioY))
						|| (((gameArea.entities[i].xPos + gameArea.entities[i].width) * gameArea.ratioX) >= (load.droppable[d].xMin * gameArea.ratioX)
						&& ((gameArea.entities[i].xPos + gameArea.entities[i].width) * gameArea.ratioX) <= (load.droppable[d].xMax * gameArea.ratioX)
						&& ((gameArea.entities[i].yPos + gameArea.entities[i].height) * gameArea.ratioY) >= (load.droppable[d].yMin * gameArea.ratioY)
						&& ((gameArea.entities[i].yPos + gameArea.entities[i].height) * gameArea.ratioY) <= (load.droppable[d].yMax * gameArea.ratioY))
						|| ((gameArea.entities[i].yPos * gameArea.ratioY) >= (load.droppable[d].yMin * gameArea.ratioY)
						&& (gameArea.entities[i].yPos * gameArea.ratioY) <= (load.droppable[d].yMax * gameArea.ratioY)
						&& ((gameArea.entities[i].xPos + gameArea.entities[i].width) * gameArea.ratioX) >= (load.droppable[d].xMin * gameArea.ratioX)
						&& ((gameArea.entities[i].xPos + gameArea.entities[i].width) * gameArea.ratioX) <= (load.droppable[d].xMax * gameArea.ratioX))
						|| ((gameArea.entities[i].xPos * gameArea.ratioX) >= (load.droppable[d].xMin * gameArea.ratioX)
						&& (gameArea.entities[i].xPos * gameArea.ratioX) <= (load.droppable[d].xMax * gameArea.ratioX)
						&& (gameArea.entities[i].yPos * gameArea.ratioY) >= (load.droppable[d].yMin * gameArea.ratioY)
						&& (gameArea.entities[i].yPos * gameArea.ratioY) <= (load.droppable[d].yMax * gameArea.ratioY)))
						&& gameArea.entities[i].isClicked
						&& load.droppable[d].isFilled == false) {

						gameArea.entities[i + gameArea.entities[i].caseOp].xPos = load.droppable[d].xMin;
						gameArea.entities[i + gameArea.entities[i].caseOp].yPos = load.droppable[d].yMin;
						gameArea.entities[i].caseOp += 1;
						gameArea.entities[i].xPos = gameArea.entities[i].xInit;
						gameArea.entities[i].yPos = gameArea.entities[i].yInit;
						gameArea.entities[i].isClicked = false;
						load.droppable[d].isFilled = true;
						load.droppable[d].parameter = gameArea.entities[i].parameter;
					}
				}
				if (gameArea.entities[i].isClicked) {
					gameArea.entities[i].xPos = gameArea.entities[i].xInit;
					gameArea.entities[i].yPos = gameArea.entities[i].yInit;
					gameArea.entities[i].isClicked = false;
				}
			}
		}
	}

	function handleInput(dt) {
		for (var i = 0; i < gameArea.entities.length; i++) {
			if (gameArea.entities[i].isClicked) {
				gameArea.entities[i].xPos = (gameArea.xMouse / gameArea.ratioX) - (gameArea.entities[i].width / 2);
				gameArea.entities[i].yPos = (gameArea.yMouse / gameArea.ratioY) - (gameArea.entities[i].height / 2);
			}
		}
	}

	gameArea.init();
	</script>
</body>
</html>